{"version":3,"sources":["../../../src/static/getRoutes/index.js"],"names":["getRoutes","config","opts","subscription","d","pageRoutes","routes","afterGetRoutes","plugins","allRoutes","allNormalizedRoutes","hasIndex","has404","incremental","Error","unshift","path","component","relative","paths","ROOT","resolve","__dirname"],"mappings":";;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;AAEe,SAASA,SAAT,OAA4D;AAAA,MAAvCC,MAAuC,QAAvCA,MAAuC;AAAA,MAA/BC,IAA+B,QAA/BA,IAA+B;AAAA,MAAvBC,YAAuB,uEAAR,UAAAC,CAAC;AAAA,WAAIA,CAAJ;AAAA,GAAO;AACzE;AACA,SAAO,iCAAmB;AAAEH,IAAAA,MAAM,EAANA,MAAF;AAAUC,IAAAA,IAAI,EAAJA;AAAV,GAAnB;AAAA;AAAA;AAAA;AAAA;AAAA,8BAAqC,iBAAMG,UAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACvBJ,MAAM,CAACD,SAAP,CAAiBE,IAAjB,CADuB;;AAAA;AACtCI,cAAAA,MADsC;AAGpCC,cAAAA,cAHoC,GAGnB,4BAAgBN,MAAM,CAACO,OAAvB,EAAgC,gBAAhC,CAHmB;AAAA;AAAA,qBAI3BD,cAAc,CAACD,MAAD,EAAS;AAAEL,gBAAAA,MAAM,EAANA;AAAF,eAAT,CAJa;;AAAA;AAI1CK,cAAAA,MAJ0C;AAMpCG,cAAAA,SANoC,sBAMpBJ,UANoB,4BAMLC,MANK;AAAA,oCAWtC,kCAAmBG,SAAnB,EAA8BR,MAA9B,CAXsC,EAQhCS,mBARgC,uBAQxCJ,MARwC,EASxCK,QATwC,uBASxCA,QATwC,EAUxCC,MAVwC,uBAUxCA,MAVwC,EAY1C;;AAZ0C,oBAatC,CAACD,QAAD,IAAa,CAACT,IAAI,CAACW,WAbmB;AAAA;AAAA;AAAA;;AAAA,oBAclC,IAAIC,KAAJ,CACJ,iJADI,CAdkC;;AAAA;AAkB1C;AACA,kBAAI,CAACF,MAAD,IAAW,CAACV,IAAI,CAACW,WAArB,EAAkC;AAChCH,gBAAAA,mBAAmB,CAACK,OAApB,CAA4B;AAC1BC,kBAAAA,IAAI,EAAE,KADoB;AAE1BC,kBAAAA,SAAS,EAAED,cAAKE,QAAL,CACTjB,MAAM,CAACkB,KAAP,CAAaC,IADJ,EAETJ,cAAKK,OAAL,CAAaC,SAAb,EAAwB,qCAAxB,CAFS;AAFe,iBAA5B;AAOD;;AA3ByC,+CA4BnCnB,YAAY,CAACO,mBAAD,CA5BuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAArC;;AAAA;AAAA;AAAA;AAAA,MAAP;AA8BD;;;;;;;;;;;;;0BAhCuBV,S","sourcesContent":["import path from 'path'\nimport { makeHookReducer } from '../../utils'\n\nimport getRoutesFromPages from './getRoutesFromPages'\nimport normalizeAllRoutes from './normalizeAllRoutes'\n\nexport default function getRoutes({ config, opts }, subscription = d => d) {\n  // We use the callback pattern here, because getRoutesFromPages supports a subscription\n  return getRoutesFromPages({ config, opts }, async pageRoutes => {\n    let routes = await config.getRoutes(opts)\n\n    const afterGetRoutes = makeHookReducer(config.plugins, 'afterGetRoutes')\n    routes = await afterGetRoutes(routes, { config })\n\n    const allRoutes = [...pageRoutes, ...routes]\n    const {\n      routes: allNormalizedRoutes,\n      hasIndex,\n      has404,\n    } = normalizeAllRoutes(allRoutes, config)\n    // If no Index page was found, throw an error. This is required\n    if (!hasIndex && !opts.incremental) {\n      throw new Error(\n        'Could not find a route for the \"index\" page of your site! This is required. Please create a page or specify a route and template for this page.'\n      )\n    }\n    // If no 404 page was found, add one. This is required.\n    if (!has404 && !opts.incremental) {\n      allNormalizedRoutes.unshift({\n        path: '404',\n        component: path.relative(\n          config.paths.ROOT,\n          path.resolve(__dirname, '../../browser/components/Default404')\n        ),\n      })\n    }\n    return subscription(allNormalizedRoutes)\n  })\n}\n"],"file":"index.js"}