{"version":3,"sources":["../../../src/static/getRoutes/getRoutesFromPages.js"],"names":["watcher","routesCache","subscription","config","opts","incremental","globExtensions","extensions","map","ext","slice","join","pagesGlob","paths","PAGES","handle","pages","routes","page","nodePath","resolve","component","relative","ROOT","path","replace","split","isPage","dev","chokidar","watch","ignoreInitial","on","type","file","includes","filename","basename","startsWith","getRoutesFromPages"],"mappings":"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","sourcesContent":["import nodePath from 'path'\nimport chokidar from 'chokidar'\n\nimport { glob, debounce } from '../../utils'\n\nlet watcher\nlet routesCache\n\nexport default (async function getRoutesFromPages(\n  { config, opts = {} },\n  subscription\n) {\n  if (opts.incremental) {\n    return subscription([])\n  }\n\n  // Make a glob extension to get all pages with the set extensions from the pages directory\n  const globExtensions = config.extensions\n    .map(ext => `${ext.slice(1)}`)\n    .join(',')\n  const pagesGlob = `${config.paths.PAGES}/**/*.{${globExtensions}}`\n  // Get the pages\n\n  const handle = pages => {\n    // Turn each page into a route\n    const routes = pages.map(page => {\n      // Glob path will always have unix style path, convert to windows if necessary\n      page = nodePath.resolve(page)\n      // Get the component path relative to ROOT\n      const component = nodePath.relative(config.paths.ROOT, page)\n      // Make sure the path is relative to the root of the site\n      let path = page.replace(`${config.paths.PAGES}`, '').replace(/\\..*/, '')\n      // turn windows paths back to unix\n      path = path.split('\\\\').join('/')\n      // Turn `/index` paths into roots`\n      path = path.replace(/\\/index$/, '/')\n      // Return the route\n      return {\n        path,\n        component,\n        isPage: true, // tag it with isPage, so we know its origin\n      }\n    })\n    return routes\n  }\n\n  if (opts.dev && !watcher) {\n    watcher = chokidar\n      .watch(config.paths.PAGES, {\n        ignoreInitial: true,\n      })\n      .on(\n        'all',\n        debounce(async (type, file) => {\n          if (!['add', 'unlink'].includes(type)) {\n            return\n          }\n          const filename = nodePath.basename(file)\n          if (filename.startsWith('.')) {\n            return\n          }\n          const pages = await glob(pagesGlob)\n          const routes = handle(pages)\n          routesCache = routes\n          subscription(routes)\n        }),\n        50\n      )\n  }\n  if (routesCache) {\n    return subscription(routesCache)\n  }\n  const pages = await glob(pagesGlob)\n  const routes = handle(pages)\n  return subscription(routes)\n})\n"],"file":"getRoutesFromPages.js"}