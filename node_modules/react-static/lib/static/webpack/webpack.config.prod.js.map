{"version":3,"sources":["../../../src/static/webpack/webpack.config.prod.js"],"names":["common","config","paths","ROOT","DIST","NODE_MODULES","SRC","ASSETS","process","env","REACT_STATIC_ENTRY_PATH","path","resolve","entry","REACT_STATIC_SITE_ROOT","siteRoot","REACT_STATIC_BASE_PATH","basePath","REACT_STATIC_PUBLIC_PATH","publicPath","REACT_STATIC_ASSETS_PATH","assetsPath","startsWith","replace","splitChunks","chunks","minSize","minChunks","maxAsyncRequests","maxInitialRequests","automaticNameDelimiter","name","cacheGroups","vendors","test","priority","default","reuseExistingChunk","extrackCSSChunks","ExtractCssChunks","filename","chunkFilename","extractCssChunks","styles","enforce","mode","context","__dirname","disableRuntime","require","output","optimization","sideEffects","minimize","minimizer","UglifyJsPlugin","cache","parallel","sourceMap","OptimizeCSSAssetsPlugin","module","rules","stage","isNode","strictExportPresence","modules","map","d","relative","cwd","extensions","externals","target","undefined","plugins","webpack","EnvironmentPlugin","CaseSensitivePathsPlugin","bundleAnalyzer","BundleAnalyzerPlugin","filter","devtool","result","libraryTarget","whitelist","optimize","LimitChunkCountPlugin","maxChunks"],"mappings":"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","sourcesContent":["import webpack from 'webpack'\nimport path from 'path'\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin'\nimport { BundleAnalyzerPlugin } from 'webpack-bundle-analyzer'\nimport UglifyJsPlugin from 'uglifyjs-webpack-plugin'\nimport nodeExternals from 'webpack-node-externals'\nimport ExtractCssChunks from 'extract-css-chunks-webpack-plugin'\nimport OptimizeCSSAssetsPlugin from 'optimize-css-assets-webpack-plugin'\nimport rules from './rules'\n\nfunction common(config) {\n  const { ROOT, DIST, NODE_MODULES, SRC, ASSETS } = config.paths\n\n  process.env.REACT_STATIC_ENTRY_PATH = path.resolve(ROOT, config.entry)\n  process.env.REACT_STATIC_SITE_ROOT = config.siteRoot\n  process.env.REACT_STATIC_BASE_PATH = config.basePath\n  process.env.REACT_STATIC_PUBLIC_PATH = config.publicPath\n  process.env.REACT_STATIC_ASSETS_PATH = config.assetsPath\n\n  if (!DIST.startsWith(ROOT)) {\n    // we build outside of project dir, so reset some paths\n    process.env.REACT_STATIC_ASSETS_PATH = config.assetsPath.replace(DIST, '')\n  }\n\n  const splitChunks = {\n    chunks: 'all',\n    minSize: 10000,\n    minChunks: 1,\n    maxAsyncRequests: 5,\n    maxInitialRequests: 5,\n    automaticNameDelimiter: '~',\n    name: true,\n    cacheGroups: {\n      vendors: {\n        test: /[\\\\/]node_modules[\\\\/]/,\n        priority: -10,\n        chunks: 'all',\n      },\n      default: {\n        minChunks: 2,\n        priority: -20,\n        reuseExistingChunk: true,\n      },\n    },\n  }\n\n  let extrackCSSChunks = new ExtractCssChunks({\n    filename: '[name].[chunkHash:8].css',\n    chunkFilename: '[id].[chunkHash:8].css',\n  })\n\n  if (!config.extractCssChunks) {\n    splitChunks.cacheGroups = {\n      styles: {\n        name: 'styles',\n        test: /\\.css$/,\n        chunks: 'all',\n        enforce: true,\n      },\n    }\n    extrackCSSChunks = new ExtractCssChunks({\n      filename: '[name].[chunkHash:8].css',\n    })\n  }\n\n  return {\n    mode: 'production',\n    context: path.resolve(__dirname, '../../../node_modules'),\n    entry: config.disableRuntime\n      ? path.resolve(ROOT, config.entry)\n      : [\n          require.resolve('../../bootstrapPlugins'),\n          require.resolve('../../bootstrapTemplates'),\n          require.resolve('../../bootstrapApp'),\n        ],\n    output: {\n      filename: '[name].[hash:8].js', // dont use chunkhash, its not a chunk\n      chunkFilename: 'templates/[name].[chunkHash:8].js',\n      path: ASSETS,\n      publicPath: process.env.REACT_STATIC_ASSETS_PATH || '/',\n    },\n    optimization: {\n      sideEffects: true,\n      minimize: true,\n      minimizer: [\n        new UglifyJsPlugin({\n          cache: true,\n          parallel: true,\n          sourceMap: true, // set to true if you want JS source maps\n        }),\n        new OptimizeCSSAssetsPlugin({}),\n      ],\n      splitChunks,\n    },\n    module: {\n      rules: rules({ config, stage: 'prod', isNode: false }),\n      strictExportPresence: true,\n    },\n    resolve: {\n      modules: [\n        ...[\n          SRC,\n          NODE_MODULES,\n          path.resolve(__dirname, '../../../node_modules'),\n          DIST,\n        ].map(d =>\n          DIST.startsWith(ROOT)\n            ? path.relative(process.cwd(), d)\n            : path.resolve(d)\n        ),\n        'node_modules',\n      ],\n      extensions: ['.wasm', '.mjs', '.js', '.json', '.jsx'],\n    },\n    externals: [],\n    target: undefined,\n    plugins: [\n      new webpack.EnvironmentPlugin(process.env),\n      extrackCSSChunks,\n      new CaseSensitivePathsPlugin(),\n      config.bundleAnalyzer && new BundleAnalyzerPlugin(),\n    ].filter(d => d),\n    devtool: 'source-map',\n  }\n}\n\nexport default function({ config, isNode }) {\n  const result = common(config)\n  if (!isNode) return result\n\n  // Node only!!!\n  result.output.filename = 'static.[chunkHash:8].js'\n  result.output.libraryTarget = 'umd'\n  result.optimization.minimize = false\n  result.optimization.minimizer = []\n  result.target = 'node'\n  result.externals = [\n    nodeExternals({\n      whitelist: [\n        'react-universal-component',\n        'webpack-flush-chunks',\n        'react-static',\n      ],\n    }),\n  ]\n  result.module.rules = rules({ config, stage: 'prod', isNode: true })\n  result.plugins = [\n    new webpack.EnvironmentPlugin(process.env),\n    new CaseSensitivePathsPlugin(),\n    new webpack.optimize.LimitChunkCountPlugin({\n      maxChunks: 1,\n    }),\n  ]\n  return result\n}\n"],"file":"webpack.config.prod.js"}