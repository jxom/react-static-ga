{"version":3,"sources":["../../src/static/exporter.threaded.js"],"names":["require","setIgnorePath","process","on","payload","oldConfig","config","routes","originalConfig","paths","DIST","Comp","glob","sync","path","resolve","ASSETS","default","DocumentTemplate","Document","DefaultDocument","tasks","i","route","push","connected","send","type","length","Number","outputFileRate","exit","console","error"],"mappings":";;;;AAIA;;AACA;;AAEA;;AACA;;AACA;;AACA;;;;;;;;;;;;AAVA;eAE0BA,OAAO,CAAC,oBAAD,C;IAAzBC,a,YAAAA,a;;AAURC,OAAO,CAACC,EAAR,CAAW,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAsB,kBAAMC,OAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAEFC,sBAAAA,SAFE,GAEoBD,OAFpB,CAEVE,MAFU,EAESC,MAFT,GAEoBH,OAFpB,CAESG,MAFT,EAGlB;;AAHkB;AAAA,6BAIG,wBAAUF,SAAS,CAACG,cAApB,CAJH;;AAAA;AAIZF,sBAAAA,MAJY;AAMlBL,sBAAAA,aAAa,CAACK,MAAM,CAACG,KAAP,CAAaC,IAAd,CAAb,CANkB,CAQlB;;AACMC,sBAAAA,IATY,GASLX,OAAO,CAACY,cAAKC,IAAL,CACnBC,cAAKC,OAAL,CAAaT,MAAM,CAACG,KAAP,CAAaO,MAA1B,EAAkC,aAAlC,CADmB,EAEnB,CAFmB,CAAD,CAAP,CAEPC,OAXY,EAYlB;;AACMC,sBAAAA,gBAbY,GAaOZ,MAAM,CAACa,QAAP,IAAmBC,+BAb1B;AAeZC,sBAAAA,KAfY,GAeJ,EAfI;;AAAA,6CAgBTC,CAhBS;AAiBhB,4BAAMC,KAAK,GAAGhB,MAAM,CAACe,CAAD,CAApB;AACAD,wBAAAA,KAAK,CAACG,IAAN;AAAA;AAAA;AAAA;AAAA,kDAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCACH,4CACDpB,OADC;AAEJE,oCAAAA,MAAM,EAANA,MAFI;AAGJiB,oCAAAA,KAAK,EAALA,KAHI;AAIJZ,oCAAAA,IAAI,EAAJA,IAJI;AAKJO,oCAAAA,gBAAgB,EAAhBA;AALI,qCADG;;AAAA;AAQT,sCAAIhB,OAAO,CAACuB,SAAZ,EAAuB;AACrBvB,oCAAAA,OAAO,CAACwB,IAAR,CAAa;AAAEC,sCAAAA,IAAI,EAAE;AAAR,qCAAb;AACD;;AAVQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAAX;AAlBgB;;AAgBlB,2BAASL,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAGf,MAAM,CAACqB,MAA3B,EAAmCN,CAAC,EAApC,EAAwC;AAAA,8BAA/BA,CAA+B;AAcvC;;AA9BiB;AAAA,6BA+BZ,oBAAQD,KAAR,EAAeQ,MAAM,CAACvB,MAAM,CAACwB,cAAR,CAArB,CA/BY;;AAAA;AAgClB,0BAAI5B,OAAO,CAACuB,SAAZ,EAAuB;AACrBvB,wBAAAA,OAAO,CAACwB,IAAR,CAAa;AAAEC,0BAAAA,IAAI,EAAE;AAAR,yBAAb;AACD;;AACDzB,sBAAAA,OAAO,CAAC6B,IAAR;;AAnCkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAqClBC,YAAAA,OAAO,CAACC,KAAR;;AACA,gBAAI/B,OAAO,CAACuB,SAAZ,EAAuB;AACrBvB,cAAAA,OAAO,CAACwB,IAAR,CAAa;AAAEC,gBAAAA,IAAI,EAAE,OAAR;AAAiBvB,gBAAAA,OAAO;AAAxB,eAAb;AACD;;AACDF,YAAAA,OAAO,CAAC6B,IAAR,CAAa,CAAb;;AAzCkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtB;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* eslint-disable import/first, import/no-dynamic-require */\n\nconst { setIgnorePath } = require('../utils/binHelper')\n\nimport glob from 'glob'\nimport path from 'path'\n\nimport getConfig from './getConfig'\nimport { DefaultDocument } from './RootComponents'\nimport { poolAll } from '../utils'\nimport exportRoute from './exportRoute'\n\nprocess.on('message', async payload => {\n  try {\n    const { config: oldConfig, routes } = payload\n    // Get config again\n    const config = await getConfig(oldConfig.originalConfig)\n\n    setIgnorePath(config.paths.DIST)\n\n    // Use the node version of the app created with webpack\n    const Comp = require(glob.sync(\n      path.resolve(config.paths.ASSETS, 'static.*.js')\n    )[0]).default\n    // Retrieve the document template\n    const DocumentTemplate = config.Document || DefaultDocument\n\n    const tasks = []\n    for (let i = 0; i < routes.length; i++) {\n      const route = routes[i]\n      tasks.push(async () => {\n        await exportRoute({\n          ...payload,\n          config,\n          route,\n          Comp,\n          DocumentTemplate,\n        })\n        if (process.connected) {\n          process.send({ type: 'tick' })\n        }\n      })\n    }\n    await poolAll(tasks, Number(config.outputFileRate))\n    if (process.connected) {\n      process.send({ type: 'done' })\n    }\n    process.exit()\n  } catch (err) {\n    console.error(err)\n    if (process.connected) {\n      process.send({ type: 'error', payload: err })\n    }\n    process.exit(1)\n  }\n})\n"],"file":"exporter.threaded.js"}