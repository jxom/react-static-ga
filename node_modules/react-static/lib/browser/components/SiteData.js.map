{"version":3,"sources":["../../../src/browser/components/SiteData.js"],"names":["siteDataPromise","SiteData","props","unmounted","setState","process","env","REACT_STATIC_ENV","axios","get","siteData","data","safeSetState","staticInfo","state","fetchSiteData","children","Loader","siteDataError","React","Component","Spinner","withSiteData","Comp","opts"],"mappings":";;;;;;;;;;AAAA;;AACA;;AAEA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA,IAAIA,eAAJ;AAEA,IAAMC,QAAQ,GAAG;AAAA;AAAA;AAAA;;AAKb,oBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,kFAAMA,KAAN;;AADiB,2FAkBJ,YAAa;AAAA;;AAC1B,UAAI,MAAKC,SAAT,EAAoB;AAClB;AACD;;AACD,uBAAKC,QAAL;AACD,KAvBkB;;AAAA;AAAA;AAAA;AAAA;AAAA,8BAwBH;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,oBAGVC,OAAO,CAACC,GAAR,CAAYC,gBAAZ,KAAiC,aAHvB;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAMsB,YAAM;AACtC,oBAAIP,eAAJ,EAAqB;AACnB,yBAAOA,eAAP;AACD;;AACDA,gBAAAA,eAAe,GAAGQ,eAAMC,GAAN,CAAU,4BAAV,CAAlB;AACA,uBAAOT,eAAP;AACD,eANgC,EANrB;;AAAA;AAAA;AAMEU,cAAAA,QANF,SAMJC,IANI;;AAaZ,oBAAKC,YAAL,CAAkB;AAAEF,gBAAAA,QAAQ,EAARA;AAAF,eAAlB;;AAbY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAxBG;;AAAA,QAGTG,UAHS,GAGM,MAAKX,KAHX,CAGTW,UAHS;AAKjB,UAAKC,KAAL,GAAa;AACX;AACA;AACA;AACAJ,MAAAA,QAAQ,EAAEG,UAAU,GAAGA,UAAU,CAACH,QAAd,GAAyB;AAJlC,KAAb;AALiB;AAWlB;;AAhBY;AAAA;AAAA,wCAiBO;AAClB,WAAKK,aAAL;AACD;AAnBY;AAAA;AAAA,2CAoBU;AACrB,WAAKZ,SAAL,GAAiB,IAAjB;AACD;AAtBY;AAAA;AAAA,6BA6CJ;AAAA,wBACsB,KAAKD,KAD3B;AAAA,UACCc,QADD,eACCA,QADD;AAAA,UACWC,MADX,eACWA,MADX;AAAA,wBAE6B,KAAKH,KAFlC;AAAA,UAECJ,QAFD,eAECA,QAFD;AAAA,UAEWQ,aAFX,eAEWA,aAFX,EAIP;;AACA,UAAIA,aAAJ,EAAmB;AACjB,cAAMA,aAAN;AACD;;AAED,UAAI,CAACR,QAAL,EAAe;AACb,eAAO,6BAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACD;;AAED,aAAOM,QAAQ,CAACN,QAAD,CAAf;AACD;AA3DY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,EACQS,eAAMC,SADd,2CAES;AACpBH,EAAAA,MAAM,EAAEI;AADY,CAFT,UAAjB;eA+DepB,Q;;;;AAER,SAASqB,YAAT,CAAsBC,IAAtB,EAAuC;AAAA,MAAXC,IAAW,uEAAJ,EAAI;AAC5C,SAAO,UAAAtB,KAAK;AAAA,WACV,6BAAC,QAAD,eAAcsB,IAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QACG,UAAAd,QAAQ;AAAA,aAAI,6BAAC,IAAD,eAAUA,QAAV,EAAwBR,KAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAJ;AAAA,KADX,CADU;AAAA,GAAZ;AAKD;;;;;;;;;;;;;0BAzEGF,e;0BAEEC,Q;0BAiEUqB,Y","sourcesContent":["import React from 'react'\nimport axios from 'axios'\n//\nimport Spinner from './Spinner'\nimport { withStaticInfo } from './StaticInfo'\n\n// Share a single promise for all siteData requests\nlet siteDataPromise\n\nconst SiteData = withStaticInfo(\n  class SiteData extends React.Component {\n    static defaultProps = {\n      Loader: Spinner,\n    }\n    constructor(props) {\n      super(props)\n\n      const { staticInfo } = this.props\n\n      this.state = {\n        // Default siteData to use the staticInfo if possible\n        // This will be undefined in development, which will\n        // then be requested at runtime.\n        siteData: staticInfo ? staticInfo.siteData : null,\n      }\n    }\n    componentDidMount() {\n      this.fetchSiteData()\n    }\n    componentWillUnmount() {\n      this.unmounted = true\n    }\n    safeSetState = (...args) => {\n      if (this.unmounted) {\n        return\n      }\n      this.setState(...args)\n    }\n    fetchSiteData = async () => {\n      // We only fetch siteData in development. Normally\n      // it is already embedded in the HTML.\n      if (process.env.REACT_STATIC_ENV === 'development') {\n        // If there is an error here, it should be caught\n        // by the nearest React ErrorBoundary\n        const { data: siteData } = await (() => {\n          if (siteDataPromise) {\n            return siteDataPromise\n          }\n          siteDataPromise = axios.get('/__react-static__/siteData')\n          return siteDataPromise\n        })()\n        this.safeSetState({ siteData })\n      }\n    }\n    render() {\n      const { children, Loader } = this.props\n      const { siteData, siteDataError } = this.state\n\n      // If there was a fetch error in dev, throw it to the nearest ErrorBoundary\n      if (siteDataError) {\n        throw siteDataError\n      }\n\n      if (!siteData) {\n        return <Loader />\n      }\n\n      return children(siteData)\n    }\n  }\n)\n\nexport default SiteData\n\nexport function withSiteData(Comp, opts = {}) {\n  return props => (\n    <SiteData {...opts}>\n      {siteData => <Comp {...siteData} {...props} />}\n    </SiteData>\n  )\n}\n"],"file":"SiteData.js"}